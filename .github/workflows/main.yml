name: c/c++ CI

on: [push]

jobs:
  ubuntu-xenial-gcc-8:
    runs-on: ubuntu-16.04
    steps:
    - name: Clone Repository
      uses: actions/checkout@master
    - name: C++ Setting
      run: |
        sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
        sudo apt-get update
        sudo apt-get install -yq g++-8 gcc-8 libc++-dev libc++abi-dev build-essential libstdc++-8-dev
    - name: Compiler Setting
      run: |
        echo "::set-env name=CC::gcc-8"
        echo "::set-env name=CXX::g++-8"
    - name: ccache setting
      run: sudo apt-get install -yq ccache
    - name: Prepare ccache timestamp
        id: ccache_cache_timestamp
        shell: cmake -P {0}
        run: |
        string(TIMESTAMP current_date "%Y-%m-%d-%H;%M;%S" UTC)
        message("::set-output name=timestamp::${current_date}")

    - name: ccache cache files
        uses: actions/cache@v1.1.0
        with:
        path: .ccache
        key: ${ { matrix.config.name } }-ccache-${ { steps.ccache_cache_timestamp.outputs.timestamp } }
        restore-keys: |
            ${ { matrix.config.name } }-ccache-
    - name: CMake build
      run: cmake -Bbuild . && cd build && cmake --build . --target install
    - name: Cppm build install
      run: cp build/cppm . && ./cppm build install
  ubuntu-xenial-llvm-8:
    runs-on: ubuntu-16.04
    steps:
    - name: Clone Repository
      uses: actions/checkout@master
    - name: C++ Setting
      run: |
        sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
        sudo add-apt-repository -y "deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-8 main"
        sudo apt-get update
        sudo apt-get install -yq clang-8 libc++-dev libc++abi-dev libstdc++-8-dev build-essential
    - name: Compiler Setting
      run: |
        echo "::set-env name=CC::clang-8"
        echo "::set-env name=CXX::clang++-8"
    - name: ccache setting
      run: sudo apt-get install -yq ccache
    - name: Prepare ccache timestamp
      id: ccache_cache_timestamp
      shell: cmake -P {0}
      run: |
        string(TIMESTAMP current_date "%Y-%m-%d-%H;%M;%S" UTC)
        message("::set-output name=timestamp::${current_date}")
    - name: ccache cache files
      uses: actions/cache@v1.1.0
      with:
      path: .ccache
      key: ${ { matrix.config.name } }-ccache-${ { steps.ccache_cache_timestamp.outputs.timestamp } }
      restore-keys: |
          ${ { matrix.config.name } }-ccache-
    - name: CMake build
      run: cmake -Bbuild . && cd build && cmake --build . --target install
    - name: Cppm build install
      run: cp build/cppm . && ./cppm build install

  #build-linux:
  #  runs-on: ubuntu-latest
  #  strategy:
  #    matrix:
  #      c-compiler: [gcc, clang]
  #      cxx-compiler: [g++, clang++]
  #  steps:
  #  - name: Clone Repository
  #    uses: actions/checkout@master
  #  - name: Compiler Setting
  #    run: echo Compiler Setting
  #    env:
  #      CC: ${{matrix.compiler}}
  #  - name: CMake build
  #    run: cmake -Bbuild . && cd build && cmake --build .
  #  - name: Cppm build install
  #    run: cd build && ./cppm build install

  #build-windows:
  #  runs-on: windows-2019
  #  steps:
  #  - name: Clone Repository
  #    uses: actions/checkout@master
  #  - name: CMake build
  #    run: |
  #      cmake -Bbuild .
  #      cd build
  #      cmake --build .
  #  - name: Cppm build install
  #    run: |
  #      cd build
  #      ./cppm build install
  #build-macos:
  #  runs-on: macos-latest
  #  strategy:
  #    matrix:
  #      c-compiler: [gcc, clang]
  #      cxx-compiler: [g++, clang++]
  #  steps:
  #  - name: Clone Repository
  #    uses: actions/checkout@master
  #  - name: Compiler Setting
  #    run: echo Compiler Setting
  #    env:
  #      CC: ${{matrix.compiler}}
  #  - name: CMake build
  #    run: cmake -Bbuild . && cd build && cmake --build .
  #  - name: Cppm build install
  #    run: cd build && ./cppm build install
